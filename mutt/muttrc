# https://neomutt.org/feature/sidebar

# set pgp_default_key = "Default"

# Source Dependencies
source ~/.mutt/keybindings.conf

# macros
# Sidebar Navigation ---------------------------------
#bind index,pager \Cj sidebar-prev
#bind index,pager \Ck sidebar-next
#bind index,pager \Cl sidebar-open
macro index b '<enter-command>toggle sidebar_visible<enter>'
macro pager b '<enter-command>toggle sidebar_visible<enter>'
#bind index B bounce-message

# Pager defs
# bind pager h exit
#bind pager gg top
bind pager G bottom
#bind pager k next-line
#bind pager j previous-line

message-hook '!(~g|~G) ~b"^-----BEGIN\ PGP\ (SIGNED\ )?MESSAGE"' "exec check-traditional-pgp"

# Other bindings
#bind index M display-message

#####################################################################
# ui
###

source ~/.mutt/colors

set markers          # mark wrapped lines of text in the pager with a +
set smart_wrap       # Don't wrap mid-word
set pager_context=5  # Retain 5 lines of previous page when scrolling.
set pager_index_lines = 10
set status_on_top    # Status bar on top.
push <show-version>  # Shows mutt version at startup

# Sidebar Patch --------------------------------------
set sidebar_visible = yes
set sidebar_width   = 24
color sidebar_new yellow default

# Status Bar -----------------------------------------
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"


# Header Options -------------------------------------
ignore *                                # ignore all headers
unignore from: to: cc: date: subject:   # show only these
unhdr_order *                           # some distros order things by default
hdr_order from: to: cc: date: subject:  # and in this order

# Use mouse wheel
#bind pager <down> next-line
#bind pager <up> previous-line

# enconding
set use_from            = yes
set envelope_from       = yes
set rfc2047_parameters  = yes # encode =?iso-8858....?= filenames

set pipe_decode         = yes # encode stuff to urlview (to help...)

# Don't add a + to urls that wrap
# unset markers

# Don't ask to confirm deletions
# set delete = no

# Don't move read mail to all mail
set move = no

# Don't show the help bar
# set help = no

#Don't wait to switch mailboxes
set sleep_time = 0

# Read top-down mail instead of bottom-up
set sort = reverse-threads

# Simplify UI
# set status_format = "%f"
# set date_format = "%m%d"
# set index_format = "%Z %D %-15.15n %s"

# Keep a list of contacts (aliases)
set alias_file = ~/.mutt/alias
set sort_alias          = alias                # sort by alias ( or address, unsorted)
set reverse_alias       = yes
source $alias_file

set query_command       = "abook --mutt-query '%s'"  # address book

# Import SMTP and IMAP credentials
source "gpg -dq ~/.mutt/protonmail.gpg |"

### Pager/
# ignore *
# unignore From Message-ID Date To Cc Bcc Subject
# set pager_stop

# Prefer plain text to html
# alternative_order multipart/mixed multipart/related text/plain

# Consult mime.types for determining types of attachments
mime_lookup applications/octet-stream

### Other
set indent_string = ">"
set reflow_wrap = 80
set reflow_text
unset reflow_space_quotes
unset imap_passive
set imap_check_subscribed
set mail_check = 15
set timeout = 15
macro index b "<enter-command>toggle sidebar_visible<enter>"
macro pager b "<enter-command>toggle sidebar_visible<enter>"
unset ssl_use_sslv3
unset ssl_use_tlsv1
set ssl_verify_dates
set ssl_verify_host
set to_chars=" +TCF"
push <show-version>
set copy = no
set pgp_use_gpg_agent
set pgp_timeout = 1800
set crypt_autosign
set crypt_replysign
set crypt_replysignencrypted
set check_new
set editor = emacs
#set mh_purge
#unset confirmappend
#unset confirmcreate
set save_address
set save_name
set mark_old
set smart_wrap
set signature= "~/.mutt/signature"
#set edit_hdrs

# Open HTML in Mutt client
auto_view text/html
alternative_order text/enriched text/plain text/html text
auto_view text/html      # text/enriched and text/plain support are builtins
                         # how to auto_view text/html takes mutt from  mailcap files:
                         # ~/.mailcap  then /etc/mailcap or so
                         # (settings with 'needsterminal' option or so)
                         # I have in my ~/.mailcap for that purpose:
                         # text/html; elinks -dump -force-html %s; needsterminal; copiousoutput;
set mailcap_path = ~/.mutt/mailcap

#####################################################################
# how to edit messages
###

set editor              = "nvim -c 'set tw=70 et' '+/^$' "
#set editor="emacs -nw --no-init-file"
set edit_headers            # put headers in editor when composing messages
                            # additioally I have a some setting in vim for
                            # my convenience (lazyness)